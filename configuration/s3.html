<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>S3 Configuration &mdash; megfile  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Hdfs Configuration" href="hdfs.html" />
    <link rel="prev" title="Common Configuration" href="common.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            megfile
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../readme.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../path_format.html">Path Format</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../configuration.html">Configuration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="common.html">Common Configuration</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">S3 Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#use-environments">Use environments</a></li>
<li class="toctree-l3"><a class="reference internal" href="#use-command">Use command</a></li>
<li class="toctree-l3"><a class="reference internal" href="#config-for-different-s3-server-or-authentications">Config for different s3 server or authentications</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#using-environment">Using environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-command">Using command:</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="hdfs.html">Hdfs Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="sftp.html">Sftp Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="http.html">HTTP Configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../megfile.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli.html">Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced.html">Advanced User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">CHANGELOG</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/megvii-research/megfile">GitHub</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">megfile</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../configuration.html">Configuration</a></li>
      <li class="breadcrumb-item active">S3 Configuration</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/configuration/s3.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="s3-configuration">
<h1>S3 Configuration<a class="headerlink" href="#s3-configuration" title="Link to this heading"></a></h1>
<p>Before using <code class="docutils literal notranslate"><span class="pre">megfile</span></code> to access files on s3, you need to set up authentication credentials for your s3 account. In addition to <a class="reference external" href="https://boto3.amazonaws.com/v1/documentation/api/latest/guide/configuration.html">boto3</a>, <code class="docutils literal notranslate"><span class="pre">megfile</span></code> also supports some additional configuration items, and the following describes some common configurations.
You can use environments and configuration file for configuration, and priority is that environment variables take precedence over configuration file.</p>
<section id="use-environments">
<h2>Use environments<a class="headerlink" href="#use-environments" title="Link to this heading"></a></h2>
<p>You can use environments to setup authentication credentials for your s3 account:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">AWS_ACCESS_KEY_ID</span></code>: access key</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AWS_SECRET_ACCESS_KEY</span></code>: secret key</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">OSS_ENDPOINT</span></code> / <code class="docutils literal notranslate"><span class="pre">AWS_ENDPOINT_URL_S3</span></code> / <code class="docutils literal notranslate"><span class="pre">AWS_ENDPOINT_URL</span></code>: endpoint url of s3</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AWS_S3_ADDRESSING_STYLE</span></code>: addressing style</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MEGFILE_S3_MAX_RETRY_TIMES</span></code>: s3 request max retry times when catch error which may fix by retry, default is <code class="docutils literal notranslate"><span class="pre">10</span></code></p></li>
</ul>
</section>
<section id="use-command">
<h2>Use command<a class="headerlink" href="#use-command" title="Link to this heading"></a></h2>
<p>You can update config file with <code class="docutils literal notranslate"><span class="pre">megfile</span></code> command easyly:
<a class="reference external" href="https://megvii-research.github.io/megfile/cli.html#megfile-config-s3">megfile config s3 [OPTIONS] AWS_ACCESS_KEY_ID AWS_SECRET_ACCESS_KEY</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>megfile<span class="w"> </span>config<span class="w"> </span>s3<span class="w"> </span>access_key<span class="w"> </span>secret_key

<span class="c1"># for aliyun</span>
$<span class="w"> </span>megfile<span class="w"> </span>config<span class="w"> </span>s3<span class="w"> </span>access_key<span class="w"> </span>secret_key<span class="w"> </span><span class="se">\</span>
--addressing-style<span class="w"> </span>virtual<span class="w"> </span><span class="se">\</span>
--endpoint-url<span class="w"> </span>http://oss-cn-hangzhou.aliyuncs.com<span class="w"> </span><span class="se">\</span>
</pre></div>
</div>
<p>You can get the configuration from <code class="docutils literal notranslate"><span class="pre">~/.aws/credentials</span></code>, like:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[default]</span>
<span class="na">aws_secret_access_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">access_key</span>
<span class="na">aws_access_key_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">secret_key</span>

<span class="na">s3</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="na">addressing_style</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">virtual</span>
<span class="w">    </span><span class="na">endpoint_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">http://oss-cn-hangzhou.aliyuncs.com</span>
</pre></div>
</div>
<p>Megfile also support a custom global endpoint url, if you not configure a endpoint url for S3 in the file. Example:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[default]</span>
<span class="na">aws_secret_access_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">access_key</span>
<span class="na">aws_access_key_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">secret_key</span>

<span class="na">endpoint_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">http://oss-cn-hangzhou.aliyuncs.com</span>
</pre></div>
</div>
</section>
<section id="config-for-different-s3-server-or-authentications">
<h2>Config for different s3 server or authentications<a class="headerlink" href="#config-for-different-s3-server-or-authentications" title="Link to this heading"></a></h2>
<p>You can operate s3 files with different endpoint urls, access keys and secret keys.
For example, you have two s3 server with different endpoint_url, access_key and secret key. With configuration, you can use path with profile name like <code class="docutils literal notranslate"><span class="pre">s3+profile_name://bucket/key</span></code> to operate different s3 server:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">megfile</span> <span class="kn">import</span> <span class="n">smart_sync</span>

<span class="n">smart_sync</span><span class="p">(</span><span class="s1">&#39;s3+profile1://bucket/key&#39;</span><span class="p">,</span> <span class="s1">&#39;s3+profile2://bucket/key&#39;</span><span class="p">)</span>
</pre></div>
</div>
<section id="using-environment">
<h3>Using environment<a class="headerlink" href="#using-environment" title="Link to this heading"></a></h3>
<p>You need use <code class="docutils literal notranslate"><span class="pre">PROFILE_NAME__</span></code> prefix, like:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PROFILE1__AWS_ACCESS_KEY_ID</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PROFILE1__AWS_SECRET_ACCESS_KEY</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PROFILE1__OSS_ENDPOINT</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PROFILE1__AWS_S3_ADDRESSING_STYLE</span></code></p></li>
</ul>
</section>
<section id="using-command">
<h3>Using command:<a class="headerlink" href="#using-command" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>megfile<span class="w"> </span>config<span class="w"> </span>s3<span class="w"> </span>access_key<span class="w"> </span>secret_key<span class="w"> </span>--profile-name<span class="w"> </span>profile1
</pre></div>
</div>
<p>Then the config file’s content will be:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[profile1]</span>
<span class="na">aws_access_key_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">access_key</span>
<span class="na">aws_secret_access_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">secret_key</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="common.html" class="btn btn-neutral float-left" title="Common Configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="hdfs.html" class="btn btn-neutral float-right" title="Hdfs Configuration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, r-eng.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>